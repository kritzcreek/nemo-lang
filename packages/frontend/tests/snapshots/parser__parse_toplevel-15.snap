---
source: packages/frontend/tests/parser.rs
expression: output
input_file: packages/frontend/tests/passing/toplevel.nemo
---
fn add_particle(p : Particle) = {
  set particles.buffer[particles.watermark] = p;
  set particles.watermark =
    i32_rem_s(particles.watermark + 1, @array_len(particles.buffer))
}

// ---
Root@0..182
  TopFn@0..182
    LINEFEED@0..1 "\n"
    FN_KW@1..3 "fn"
    SPACE@3..4 " "
    IDENT@4..16 "add_particle"
    L_PAREN@16..17 "("
    Param@17..29
      IDENT@17..18 "p"
      SPACE@18..19 " "
      COLON@19..20 ":"
      SPACE@20..21 " "
      TyCons@21..29
        UPPER_IDENT@21..29 "Particle"
    R_PAREN@29..30 ")"
    SPACE@30..31 " "
    EQUALS@31..32 "="
    SPACE@32..33 " "
    EBlock@33..182
      L_BRACE@33..34 "{"
      DSet@34..82
        LINEFEED@34..35 "\n"
        SPACE@35..37 "  "
        SET_KW@37..40 "set"
        SPACE@40..41 " "
        SetTarget@41..79
          EArrayIdx@41..79
            EStructIdx@41..57
              EVar@41..50
                IDENT@41..50 "particles"
              DOT@50..51 "."
              IDENT@51..57 "buffer"
            L_BRACKET@57..58 "["
            EStructIdx@58..77
              EVar@58..67
                IDENT@58..67 "particles"
              DOT@67..68 "."
              IDENT@68..77 "watermark"
            R_BRACKET@77..78 "]"
            SPACE@78..79 " "
        EQUALS@79..80 "="
        SPACE@80..81 " "
        EVar@81..82
          IDENT@81..82 "p"
      SEMICOLON@82..83 ";"
      DSet@83..180
        LINEFEED@83..84 "\n"
        SPACE@84..86 "  "
        SET_KW@86..89 "set"
        SPACE@89..90 " "
        SetTarget@90..110
          EStructIdx@90..110
            EVar@90..99
              IDENT@90..99 "particles"
            DOT@99..100 "."
            IDENT@100..109 "watermark"
            SPACE@109..110 " "
        EQUALS@110..111 "="
        ECall@111..180
          EVar@111..125
            LINEFEED@111..112 "\n"
            SPACE@112..116 "    "
            IDENT@116..125 "i32_rem_s"
          EArgList@125..180
            L_PAREN@125..126 "("
            EBinary@126..149
              EStructIdx@126..146
                EVar@126..135
                  IDENT@126..135 "particles"
                DOT@135..136 "."
                IDENT@136..145 "watermark"
                SPACE@145..146 " "
              BinOp@146..148
                PLUS@146..147 "+"
                SPACE@147..148 " "
              ELit@148..149
                LitInt@148..149
                  INT_LIT@148..149 "1"
            COMMA@149..150 ","
            SPACE@150..151 " "
            EIntrinsic@151..179
              AT_IDENT@151..161 "@array_len"
              EArgList@161..179
                L_PAREN@161..162 "("
                EStructIdx@162..178
                  EVar@162..171
                    IDENT@162..171 "particles"
                  DOT@171..172 "."
                  IDENT@172..178 "buffer"
                R_PAREN@178..179 ")"
            R_PAREN@179..180 ")"
      LINEFEED@180..181 "\n"
      R_BRACE@181..182 "}"
